# Конфигурация окружения LVGL на T113-PRO

Введение: Для удобства использования отладочной платы 100ASK_T113-PRO при изучении разработки LVGL-UI мы специально оптимизировали процесс обучения и упростили конфигурацию, предоставив чрезвычайно простое руководство для быстрого начала работы. Вы можете очень удобно и быстро начать разработку приложений LVGL-UI без необходимости разбираться в сложных проблемах настройки окружения и компиляции SDK. Передача файлов требует только один кабель USB Type-C и очень проста в использовании.

Поддержка системного образа:

* набор утилит alsa-utils
* набор утилит blue-z
* набор утилит dbus
* воспроизведение видео tplayerdemo
* библиотека tslib
* инструмент отладки valgrind
* отладка gdbserver

Поддержка цепочки инструментов:

* GCC G++ LD AR AS GDB и т.д.
* заголовочные файлы стандартной библиотеки C, включая stdio.h и т.д.
* включает окружение sysroot, поставляемое с системным образом, для кросс-компиляции соответствующих приложений. Например, включает заголовочные файлы alsa/.

## Подготовка

### Подготовка аппаратного обеспечения

1. Отладочная плата 100ASK T113-Pro x1, которая может нормально работать и запускаться.
2. (7-дюймовый RGB экран 1024x600 с двусторонним подключением) подключен к отладочной плате.
3. Компьютер, на котором может работать виртуальная машина Ubuntu 18.

### Получение специального образа

* Образ для курса T113-LVGL8:
  * [100ask_t113-pro_tinasdkv2.0_lvgl8_rgb-7inch1024x600_v1.0.img](https://dongshanpi.cowtransfer.com/s/52a7cbadeb6e4a)

После получения, **распакуйте** архив образа, и вы увидите два файла: файл образа и READM.md. Файл образа можно использовать с соответствующим инструментом прошивки отладочной платы для прошивки. Файл README.md содержит хеш-сумму MD5 образа и описание версии. Клиенты могут использовать хеш-сумму для проверки целостности файла и описания функциональности версии образа.

Примечание: После распаковки файл образа с расширением .img - это то, что нужно использовать.

### Получение цепочки инструментов

Мы предоставляем клиентам цепочку инструментов, специально разработанную для компиляции и разработки LVGL. Ее можно загрузить по следующим ссылкам:

* Цепочка инструментов для системы T113-LVGL8:
  * [gcc-6.4-2017.11-x86_64_arm-openwrt-linux-eabi-musl.tar.gz](https://dongshanpi.cowtransfer.com/s/21041b2a2e4642)

* Специализированная sysroot для системы T113-LVGL8:
  * [100ask_t113-pro_arm-openwrt-linux-eabi-glibc_sysroot_v1.0.tar.gz](https://dongshanpi.cowtransfer.com/s/92581a330ce14d)

После получения, **распакуйте** архивы обоих файлов, и вы увидите файл README.md и соответствующие файлы. Файл README.md содержит хеш-сумму MD5 образа и описание версии. Клиенты могут использовать хеш-сумму для проверки целостности файла и описания функциональности версии образа.

Примечание: После распаковки файл с расширением .tar.gz - это то, что нужно использовать.

### Получение исходного кода LVGL

Мы предоставляем клиентам базовые примеры программ LVGL. Эти примеры помогут клиентам понять процесс разработки приложений LVGL и могут быть загружены по следующим ссылкам:

- Исходный код примеров LVGL: [allwinner-tinasdk_lvgl8_demo_V1.0.zip Щелкните для загрузки](https://dongshanpi.cowtransfer.com/s/4b36b0b0a03349)

После получения распакуйте архив исходного кода, и вы увидите файл README.md и соответствующие файлы исходного кода. Файл README.md содержит хеш-сумму MD5 образа и описание версии. Клиенты могут использовать хеш-сумму для проверки целостности файла и описания функциональности версии образа.

Примечание: После распаковки файл с расширением .tar.gz - это то, что нужно использовать.

## Начало работы

### Запуск образа Ubuntu

Здесь предлагаются два способа на ваш выбор.

Способ первый: Если вы уже настроили виртуальную машину в соответствии с страницей [《**среда разработки приложений Linux**》---> 《**конфигурация окружения разработки**》](http://allwinner-docs.100ask.org/Application/LinuxEnvironmentonfiguration/01-EnvironmentalConfiguration.html), вы можете напрямую перейти к следующему подразделу《конфигурация системного окружения разработки》

Способ второй: Если у вас нет виртуальной машины и вы не хотите переконфигурировать, вы можете загрузить и использовать уже настроенную нами виртуальную машину [Allwinner-TinaSDK_100ASK_T113-PRO_LVGLDemo_Ubuntu-18.04_VM_V1.0.zip](https://dongshanpi.cowtransfer.com/s/7feb221321384a). (Примечание: настроенная виртуальная машина потребляет относительно большой объем памяти, загрузка будет медленнее) Ссылка для загрузки: https://dongshanpi.cowtransfer.com/s/7feb221321384a

![100ask-VMware-lvgl](http://photos.100ask.net/allwinner-docs/lvgl8-ui/100ask-VMware-lvgl.gif)

Примечание: имя пользователя виртуальной машины **ubuntu**, пароль **ubuntu**. **Если вы используете предоставленный нами образ виртуальной машины, он уже содержит цепочку инструментов и примеры LVGL DEMO.**

### Конфигурация системного окружения разработки

Примечание: **Если вы используете способ второй с предоставленной нами виртуальной машиной, все следующие зависимости окружения уже настроены.**

Если вы используете вашу собственную систему Ubuntu, вам необходимо установить зависимости, необходимые для компиляции системы.

``` shell
sudo apt install open-vm-tools-desktop
sudo apt-get install -y  sed make binutils build-essential  gcc g++ bash patch gzip bzip2 perl  tar cpio unzip rsync file  bc wget python  cvs git mercurial rsync  subversion android-tools-mkbootimg vim  libssl-dev  android-tools-fastboot
sudo apt-get install -y  libncurses5-dev   u-boot-tools
```

### Обновление системного образа отладочной платы

Поскольку этот раздел требует определенного образа и окружения для разработки, вам необходимо обновить системный образ на отладочной плате. При прошивке системы обратитесь к статье [Прошивка системы отладочной платы](http://allwinner-docs.100ask.org/Basic/100ASK_T113-PRO/03-1_FlashSystem.html). Однако обратите внимание, что файл образа для прошивки должен быть `100ask_t113-pro_tinasdkv2.0_lvgl8_rgb-7inch1024x600_v1.0.img` из раздела《Получение специального образа》 выше. После прошивки образ будет содержать все необходимые зависимости для курса разработки LVGL-UI и примеры тестовых программ lv_example.

## Запуск примеров LVGL

### Включение отладочной платы

Подключите питание или кабель данных USB Type-C в соответствии с требованиями, переведите переключатель DIP, и включите отладочную плату. Если вы используете отладочную плату впервые, пожалуйста, обратитесь к статье [Быстрый старт](http://allwinner-docs.100ask.org/Basic/100ASK_T113-PRO/03-QuickStart.html) в разделе использования отладочной платы 100ASK_T113-PRO.

### Запуск примеров LVGL

Откройте программное обеспечение последовательного терминала. Здесь я использую MobaXterm в качестве демонстрации. Выберите номер порта последовательной связи отладочной платы, который можно посмотреть в диспетчере устройств.

![image-20230707143104904](http://photos.100ask.net/allwinner-docs/lvgl8-ui/image-20230707143104904.png)

Номер порта моего устройства - `COM15`, поэтому в программном обеспечении последовательного терминала следует использовать `COM15`, скорость передачи 115200. Процедура операции выглядит следующим образом:

![100ask-lvgl-serial-demo](http://photos.100ask.net/allwinner-docs/lvgl8-ui/100ask-lvgl-serial-demo.gif)

Приведенная выше операция - это демонстрация на 7-дюймовом RGB экране. Введите команду тестирования:

```
root@TinaLinux:/# lv_examples 0
wh=1024x600, vwh=1024x1200, bpp=32, rotated=0
Turn on double buffering.
```

После ввода на экране дисплея будут показаны примеры LVGL, как показано ниже:

![](http://photos.100ask.net/allwinner-docs/lvgl8-ui/LVGL-Widgets-Demo.gif)

Примечание: примеры LVGL будут автоматически адаптироваться к размеру экрана. Пропорции могут отличаться от показанных выше.

В системе встроено 5 демонстрационных приложений LVGL:

```
lv_examples 0, is lv_demo_widgets
lv_examples 1, is lv_demo_music
lv_examples 2, is lv_demo_benchmark
lv_examples 3, is lv_demo_keypad_encoder
lv_examples 4, is lv_demo_stress
```

## Разработка программ LVGL

### Конфигурация окружения компиляции LVGL

**Примечание:** Если вы используете предоставленную нами виртуальную машину из раздела《начало работы - запуск виртуальной машины способ второй》, вы можете пропустить этот раздел и перейти к следующему подразделу《компиляция исходного кода LVGL》. Если вы используете самостоятельно настроенную виртуальную машину, внимательно прочитайте и следуйте инструкциям этого раздела.

Предположим, вы передадите загруженные архивы цепочки инструментов и исходного кода в формате tar.gz в любой каталог виртуальной машины. Здесь я создам новый каталог lvgl для хранения трех архивов. Введите:

```
ubuntu@ubuntu1804ubuntu@ubuntu1804:~$ mkdir lvgl-work
ubuntu@ubuntu1804:~$ cd lvgl-work
```

Передайте файл `allwinner-tinasdk_lvgl8_demo_V1.0.tar.gz` в каталог `lvgl-work`, как показано ниже:

```
ubuntu@ubuntu1804:~/lvgl-works$ ls
allwinner-tinasdk_lvgl8_demo_V1.0.tar.gz
```

Создайте папку `toolchain` для хранения папок `sysroot` и `gcc`:

```
ubuntu@ubuntu1804ubuntu@ubuntu1804:~$ mkdir toolchain
ubuntu@ubuntu1804:~$ cd toolchain
```

После передачи архивов выглядит так:

```
ubuntu@ubuntu1804:~/lvgl_work/toolchain$ ls
100ask_t113-pro_arm-openwrt-linux-eabi-glibc_sysroot_v1.0.tar.gz
gcc-6.4-2017.11-x86_64_arm-openwrt-linux-eabi-musl.tar.gz
```

В каталоге toolchain распакуйте архив цепочки инструментов gcc и архив зависимостей sysroot, введите:

```
tar -xzvf gcc-6.4-2017.11-x86_64_arm-openwrt-linux-eabi-musl.tar.gz
```

```
tar -xzvf 100ask_t113-pro_arm-openwrt-linux-eabi-glibc_sysroot_v1.0.tar.gz
```

После распаковки вернитесь в каталог lvgl_work верхнего уровня и введите:

```
ubuntu@ubuntu1804:~/lvgl_work/toolchain$ cd ../
ubuntu@ubuntu1804:~/lvgl_work$
```

Распакуйте архив исходного кода примера LVGL:

```
tar -xzvf allwinner-tinasdk_lvgl8_demo_V1.0.tar.gz
```

Структура каталога после распаковки выглядит следующим образом:

```
ubuntu@ubuntu1804:~/lvgl_work$ tree -L 2
.
├── allwinner-tinasdk_lvgl8_demo_V1.0.tar.gz
├── lv_port_linux_frame_buffer
│   ├── CMakeLists.txt
│   ├── LICENSE
│   ├── lv_conf.h
│   ├── lv_drivers
│   ├── lv_drv_conf.h
│   ├── lvgl
│   ├── main.c
│   ├── Makefile
│   ├── mouse_cursor_icon.c
│   └── README.md
└── toolchain
    ├── 100ask_t113-pro_arm-openwrt-linux-eabi-glibc_sysroot_v1.0.tar.gz
    ├── arm-openwrt-linux-eabi-musl
    ├── gcc-6.4-2017.11-x86_64_arm-openwrt-linux-eabi-musl.tar.gz
    ├── sysroot
    └── toolchain

7 directories, 11 files

```

`lv_port_linux_frame_buffer` - это исходный код примера LVGL Demo. `toolchain` содержит цепочку инструментов кросс-компиляции gcc и файлы зависимостей sysroot.

Далее начните изменять файл Makefile в исходном коде, чтобы исходный код LVGL использовал загруженную цепочку инструментов для компиляции.

Перейдите в каталог bin каталога цепочки инструментов gcc и проверьте, существует ли цепочка инструментов кросс-компиляции:

```
ubuntu@ubuntu1804:~/lvgl_work/toolchain/arm-openwrt-linux-eabi-musl/bin$ ls arm-openwrt-linux-muslgnueabi-gcc
arm-openwrt-linux-muslgnueabi-gcc
ubuntu@ubuntu1804:~/lvgl_work/toolchain/arm-openwrt-linux-eabi-musl/bin$ pwd
/home/ubuntu/lvgl_work/toolchain/arm-openwrt-linux-eabi-musl/bin
```

Абсолютный путь цепочки инструментов кросс-компиляции `arm-openwrt-linux-muslgnueabi-gcc`:

```
/home/ubuntu/lvgl_work/toolchain/arm-openwrt-linux-eabi-musl/bin/arm-openwrt-linux-muslgnueabi-gcc
```

Перейдите в каталог исходного кода LVGL и просмотрите файлы исходного кода:

```
ubuntu@ubuntu1804:~/lvgl_work$ cd lv_port_linux_frame_buffer/
ubuntu@ubuntu1804:~/lvgl_work/lv_port_linux_frame_buffer$ ls
CMakeLists.txt  LICENSE  lv_conf.h  lv_drivers  lv_drv_conf.h  lvgl  main.c  Makefile  mouse_cursor_icon.c  README.md
```

Отредактируйте файл Makefile:

```
vi Makefile
```

Измените `CC` в файле Makefile на только что подтвержденный абсолютный путь цепочки инструментов кросс-компиляции. Например, абсолютный путь цепочки инструментов gcc, который я только что подтвердил:

```
/home/ubuntu/lvgl_work/toolchain/arm-openwrt-linux-eabi-musl/bin/arm-openwrt-linux-muslgnueabi-gcc
```

Тогда измените `CC` в файле Makefile на абсолютный путь цепочки инструментов кросс-компиляции gcc:

![image-20230708140533761](http://photos.100ask.net/allwinner-docs/lvgl8-ui/image-20230708140533761.png)

Процедура изменения выглядит следующим образом:

![100ask-lvgl-modifyMakefile](http://photos.100ask.net/allwinner-docs/lvgl8-ui/100ask-lvgl-modifyMakefile.gif)

После завершения редактирования сохраните и выйдите из интерфейса редактирования.

### Компиляция исходного кода LVGL

В этот момент необходимо указать папку, содержащую цепочку инструментов, файлы библиотек и файлы заголовков, которые используются для кросс-компиляции. В терминале введите:

```
export ARCH=arm
export CROSS_COMPILE=arm-openwrt-linux-muslgnueabi-
export PATH=$PATH:/home/ubuntu/lvgl_work/toolchain/arm-openwrt-linux-eabi-musl/bin/
export SYSROOT_DIR=/home/ubuntu/lvgl_work/toolchain/sysroot/
export STAGING_DIR=/home/ubuntu/lvgl_work/toolchain/arm-openwrt-linux-eabi-musl/
```

Примечание: Если вы используете самостоятельно настроенную виртуальную машину, пожалуйста измените на соответствующие пути. Если вы используете предоставленный нами способ второй, просто скопируйте и вставьте в терминал ubuntu18.04 для выполнения.

После конфигурации введите `make` для начала компиляции. Процесс компиляции выглядит следующим образом:

![100ask-t113-lvgl-makeAndBuild](http://photos.100ask.net/allwinner-docs/lvgl8-ui/100ask-t113-lvgl-makeAndBuild.gif)

После завершения компиляции в текущем каталоге будет создана программа с именем `demo`:

```
book@100ask:~/lvgl-work/lv_port_linux_frame_buffer$ ls demo
demo
```

### Загрузка и запуск на отладочной плате

Примечание: По умолчанию вышеупомянутое окружение системы Ubuntu и созданный нами образ виртуальной машины уже имеют настроенное окружение adb. Вам просто нужно обратиться к статье [3-передача файлов через adb](http://allwinner-docs.100ask.org/Basic/100ASK_V853-PRO/03-StartFirstExperience.html#_3-%E9%80%9A%E8%BF%87adb%E4%BC%A0%E8%BE%93%E6%96%87%E4%BB%B6), чтобы подключить вашу отладочную плату к системе Ubuntu, а затем вы можете выполнить следующие шаги для начала загрузки.

Используйте функцию ADB в системе Ubuntu для передачи созданной программы `demo` на отладочную плату для запуска. Подключите устройство ADB к виртуальной машине. Проверьте номер устройства ADB:

```
abd devices
```

Передайте программу примера LVGL в корневой каталог отладочной платы:

```
adb push demo /mnt/UDISK
```

Процесс операции выглядит следующим образом:

![100ask-lvgl-adbPush](http://photos.100ask.net/allwinner-docs/lvgl8-ui/100ask-lvgl-adbPush.gif)

После завершения передачи переключитесь на программное обеспечение последовательного терминала отладочной платы, перейдите в терминал и введите следующую команду для просмотра на экране запуска новой скомпилированной программы demo:

```
root@TinaLinux:/# cd /mnt/UDISK
root@TinaLinux:/mnt/UDISK# ls
demo
root@TinaLinux:/mnt/UDISK# ./demo 0
wh=1024x600, vwh=1024x1200, bpp=32, rotated=0
```

После ввода команды вы сможете увидеть на экране встроенный в образ пример lvgl demo.

## Углубленное изучение курса

### Обучение специализированному курсу LVGL

Курс введения в LVGL с нулевыми знаниями (куратор Вэй Дун Шань). Учебник основан на версии lvgl v8.2.

<iframe src="//player.bilibili.com/player.html?aid=209749730&bvid=BV1Ya411r7K2&cid=458073148&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>

### Обучение проектному курсу LVGL

* **Система удаленного мониторинга и отображения температуры и влажности на основе LVGL**
   Навигация по курсу: [**forums.100ask.net/t/topic/602**](http://forums.100ask.net/t/topic/602)
	* 1. Перенос LVGL на отладочную плату Linux
	* 2. Предварительный перенос MQTT на Ubuntu и отладочную плату Linux
	* 3. SquareLine Studio и эмулятор LVGL
	* 4. Система мониторинга температуры и влажности - рисование линейной диаграммы температуры и влажности
	* 5. Система мониторинга температуры и влажности - изучение базовых операций paho mqtt
	* 6. Система мониторинга температуры и влажности - многопоточность и получение/отображение температуры и влажности
	* 7. Разработка подсистемы сбора данных температуры и влажности MCU
	* 8. Простое использование платформы интернета вещей Alibaba Cloud

* 100ask linux GUI рабочего стола, на основе LVGL 8.1.
   * Видеоурок LVGL: https://www.bilibili.com/video/BV1Ya411r7K2
   * Репозиторий исходного кода: https://gitee.com/weidongshan/lv_100ask_linux_desktop

* lv_lib_100ask - это различные готовые к использованию решения на основе библиотеки lvgl или расширенные интерфейсы для различных компонентов библиотеки lvgl.
  * Видеоурок переноса: https://www.bilibili.com/video/BV1Xa41197uh?p=9
  * Репозиторий исходного кода: https://gitee.com/weidongshan/lv_lib_100ask.git

### Дополнительные примеры
